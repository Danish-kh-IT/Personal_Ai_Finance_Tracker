{% extends 'tracker/base.html' %} {% block content %}
<div class="py-6">
  <div
    class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8"
  >
    <div>
      <h1
        class="text-3xl font-bold text-gray-900 dark:text-white tracking-tight"
      >
        Budget Management
      </h1>
      <p class="mt-1 text-sm text-gray-500 dark:text-slate-400">
        Set limits and track your spending goals
      </p>
    </div>
    <div class="mt-4 sm:mt-0">
      <a
        href="{% url 'budget_create' %}"
        class="inline-flex items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-primary hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all"
      >
        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Create Budget
      </a>
    </div>
  </div>

  {% if budgets %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for budget_info in budgets %}
    <div
      class="bg-white dark:bg-slate-900/40 rounded-xl shadow-sm border border-gray-200 dark:border-slate-800 hover:shadow-md transition-all duration-300 relative overflow-hidden group"
    >
      <!-- Status Strip -->
      <div
        class="absolute top-0 left-0 w-1 h-full {% if budget_info.exceeded %}bg-red-500 {% elif budget_info.percentage >= 80 %}bg-orange-500 {% else %}bg-green-500{% endif %}"
      ></div>

      <div class="p-6 pl-8">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white">
              {{ budget_info.budget.category.name|default:"Overall Budget" }}
            </h3>
            <span
              class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-slate-800 text-gray-800 dark:text-slate-300 uppercase tracking-wide mt-1"
            >
              {{ budget_info.budget.period }}
            </span>
          </div>
          <div
            class="bg-gray-50 dark:bg-slate-800/50 p-2 rounded-lg group-hover:bg-gray-100 dark:group-hover:bg-slate-800 transition-colors"
          >
            {% if budget_info.exceeded %}
            <i data-lucide="alert-octagon" class="w-5 h-5 text-red-500"></i>
            {% elif budget_info.percentage >= 80 %}
            <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-500"></i>
            {% else %}
            <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
            {% endif %}
          </div>
        </div>

        <div class="space-y-4">
          <!-- Progress Bar -->
          <div class="relative pt-1">
            <div class="flex mb-2 items-center justify-between">
              <div>
                <span
                  class="text-xs font-semibold inline-block text-gray-600 dark:text-slate-400"
                >
                  {{ budget_info.percentage|floatformat:0 }}% Used
                </span>
              </div>
              <div class="text-right">
                <span
                  class="text-xs font-semibold inline-block text-gray-600 dark:text-slate-400"
                >
                  Rs. {{ budget_info.spent|floatformat:0 }} / {{
                  budget_info.budget.amount|floatformat:0 }}
                </span>
              </div>
            </div>
            <div
              class="overflow-hidden h-2 mb-1 text-xs flex rounded bg-gray-100 dark:bg-slate-800"
            >
              <div
                style="width:{{ budget_info.percentage }}%"
                class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center transition-all duration-500 {% if budget_info.exceeded %}bg-red-500 {% elif budget_info.percentage >= 80 %}bg-orange-500 {% else %}bg-green-500{% endif %}"
              ></div>
            </div>
          </div>

          <!-- Details -->
          <div class="flex justify-between items-center text-sm">
            <span class="text-gray-500 dark:text-slate-400">Remaining:</span>
            <span
              class="font-bold {% if budget_info.exceeded %}text-red-600{% else %}text-green-600{% endif %}"
            >
              {% if budget_info.exceeded %} - Rs. {{
              budget_info.remaining|stringformat:"f"|slice:"1:" }} {% else %}
              Rs. {{ budget_info.remaining|floatformat:2 }} {% endif %}
            </span>
          </div>
        </div>

        <!-- Actions -->
        <div
          class="mt-6 flex justify-end space-x-2 border-t border-gray-50 dark:border-slate-800/50 pt-4"
        >
          <a
            href="{% url 'budget_create' %}?id={{ budget_info.budget.id }}"
            class="text-gray-400 hover:text-primary transition-colors p-1"
            title="Edit"
          >
            <i data-lucide="edit-2" class="w-4 h-4"></i>
          </a>
          <form
            method="POST"
            action="{% url 'budget_delete' budget_info.budget.id %}"
            class="inline"
          >
            {% csrf_token %}
            <button
              type="submit"
              class="text-gray-400 hover:text-red-500 transition-colors p-1"
              onclick="return confirm('Delete this budget?');"
              title="Delete"
            >
              <i data-lucide="trash-2" class="w-4 h-4"></i>
            </button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div
    class="bg-white rounded-xl shadow-sm border border-gray-200 text-center py-16 px-4"
  >
    <div
      class="bg-gray-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"
    >
      <i
        data-lucide="piggy-bank"
        class="w-8 h-8 text-gray-400 dark:text-slate-500"
      ></i>
    </div>
    <h3 class="text-lg font-medium text-gray-900 dark:text-white">
      No budgets set
    </h3>
    <p class="mt-1 text-gray-500 dark:text-slate-400 max-w-sm mx-auto">
      Create a budget to keep track of your spending limits and save more.
    </p>
    <div class="mt-6">
      <a
        href="{% url 'budget_create' %}"
        class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-indigo-700"
      >
        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Create First Budget
      </a>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
