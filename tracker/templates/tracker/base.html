{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finance Tracker</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Cdefs%3E%3ClinearGradient id='grad1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%234F46E5;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2310B981;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='128' height='128' rx='32' fill='url(%23grad1)' /%3E%3Ctext x='50%25' y='68%25' font-family='Outfit, Arial, sans-serif' font-weight='800' font-size='64' fill='white' text-anchor='middle' dominant-baseline='middle'%3EFT%3C/text%3E%3Cpath d='M40 90 L88 90' stroke='white' stroke-width='4' stroke-linecap='round' opacity='0.3'/%3E%3C/svg%3E"
    />

    <!-- Google Fonts: Outfit -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Outfit", "sans-serif"],
            },
            colors: {
              primary: "#4F46E5", // Indigo 600 - Main Brand Color
              primaryLight: "#818CF8", // Indigo 400
              primaryDark: "#4338CA", // Indigo 700
              secondary: "#10B981", // Emerald 500
              dark: "#0F172A", // Slate 900
              light: "#F8FAFC", // Slate 50
              surface: "#FFFFFF",
            },
            animation: {
              "slide-in-right":
                "slideInRight 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards",
              "slide-out-right": "slideOutRight 0.4s ease-in forwards",
              "fade-in-up": "fadeInUp 0.6s ease-out forwards",
              "pulse-slow": "pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite",
            },
            keyframes: {
              slideInRight: {
                "0%": { transform: "translateX(100%)", opacity: "0" },
                "100%": { transform: "translateX(0)", opacity: "1" },
              },
              slideOutRight: {
                "0%": { transform: "translateX(0)", opacity: "1" },
                "100%": { transform: "translateX(100%)", opacity: "0" },
              },
              fadeInUp: {
                "0%": { transform: "translateY(20px)", opacity: "0" },
                "100%": { transform: "translateY(0)", opacity: "1" },
              },
            },
            backdropBlur: {
              xs: "2px",
            },
          },
        },
      };
    </script>

    <!-- Heroicons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      body {
        font-family: "Outfit", sans-serif;
        background-color: #f3f4f6;
        transition:
          background-color 0.3s ease,
          color 0.3s ease;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background-image:
          radial-gradient(
            at 0% 0%,
            rgba(79, 70, 229, 0.1) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 100% 0%,
            rgba(16, 185, 129, 0.1) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 100% 100%,
            rgba(236, 72, 153, 0.05) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 0% 100%,
            rgba(59, 130, 246, 0.1) 0px,
            transparent 50%
          );
        background-attachment: fixed;
      }

      .dark body {
        background-color: #0f172a;
      }

      .dark body::before {
        background-image:
          radial-gradient(
            at 0% 0%,
            rgba(79, 70, 229, 0.15) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 100% 0%,
            rgba(16, 185, 129, 0.1) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 100% 100%,
            rgba(79, 70, 229, 0.1) 0px,
            transparent 50%
          );
      }

      /* Glassmorphism Classes */
      .glass-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow:
          0 4px 6px -1px rgba(0, 0, 0, 0.05),
          0 2px 4px -1px rgba(0, 0, 0, 0.03);
        transition:
          background 0.3s ease,
          border 0.3s ease;
      }

      .dark .glass-card {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .glass-nav {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        transition:
          background 0.3s ease,
          border 0.3s ease;
      }

      .dark .glass-nav {
        background: rgba(15, 23, 42, 0.82);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      /* Hover Card Animation */
      .hover-card-anim {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .hover-card-anim:hover {
        transform: translateY(-4px);
        box-shadow:
          0 10px 25px -5px rgba(0, 0, 0, 0.1),
          0 8px 10px -6px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body
    class="text-slate-800 dark:text-slate-200 antialiased min-h-screen flex flex-col selection:bg-primary/20 selection:text-primary transition-colors duration-300"
  >
    <!-- Navbar -->
    {% if user.is_authenticated %}
    <nav class="glass-nav fixed w-full z-50 top-0 transition-all duration-300">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 relative z-50 bg-inherit">
          <!-- Logo -->
          <div class="flex items-center">
            <a
              href="{% url 'dashboard' %}"
              class="flex items-center gap-2.5 group"
            >
              <div
                class="bg-gradient-to-br from-primary to-primaryDark p-2 rounded-xl shadow-lg shadow-primary/20 group-hover:scale-105 transition-transform duration-300"
              >
                <i data-lucide="wallet" class="w-5 h-5 text-white"></i>
              </div>
              <span
                class="font-bold text-xl tracking-tight text-slate-800 dark:text-white"
                >Finance<span class="text-primary">Tracker</span></span
              >
            </a>
          </div>

          <!-- Desktop Menu -->
          <div class="hidden md:flex items-center space-x-1">
            <a
              href="{% url 'dashboard' %}"
              class="px-4 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-primary hover:bg-primary/5 transition-all flex items-center gap-2"
            >
              <i data-lucide="layout-dashboard" class="w-4 h-4"></i> Dashboard
            </a>
            <a
              href="{% url 'expense_list' %}"
              class="px-4 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-primary hover:bg-primary/5 transition-all flex items-center gap-2"
            >
              <i data-lucide="history" class="w-4 h-4"></i> History
            </a>
            <a
              href="{% url 'budget_list' %}"
              class="px-4 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-primary dark:hover:text-primary hover:bg-primary/5 transition-all flex items-center gap-2"
            >
              <i data-lucide="pie-chart" class="w-4 h-4"></i> Budgets
            </a>

            <div class="mx-2 h-6 w-px bg-slate-200 dark:bg-slate-800"></div>

            <div class="mx-2 h-6 w-px bg-slate-200 dark:bg-slate-800"></div>

            <div class="flex items-center gap-3 pl-2">
              <div class="flex flex-col items-end">
                <span
                  class="text-xs font-bold text-slate-700 dark:text-slate-300"
                  >{{ user.username }}</span
                >
              </div>
              <div
                class="h-8 w-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center border border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400"
              >
                <i data-lucide="user" class="w-4 h-4"></i>
              </div>
              <a
                href="{% url 'logout' %}"
                class="ml-2 p-2 rounded-lg text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-all"
                title="Logout"
              >
                <i data-lucide="log-out" class="w-5 h-5"></i>
              </a>
            </div>
          </div>

          <!-- Mobile Menu Button -->
          <div class="flex items-center md:hidden">
            <button
              id="mobile-menu-btn"
              type="button"
              class="text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white focus:outline-none p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
            >
              <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile Menu (Accordion Style) -->
      <div
        id="mobile-menu"
        class="md:hidden absolute top-16 left-0 w-full bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl border-b border-slate-200 dark:border-slate-800 shadow-xl transition-all duration-300 ease-in-out -translate-y-[150%] opacity-0 -z-10 pointer-events-none"
      >
        <div class="px-4 py-4 space-y-2">
          <a
            href="{% url 'dashboard' %}"
            class="block px-4 py-3 rounded-xl text-base font-medium text-slate-700 dark:text-slate-300 hover:text-primary dark:hover:text-primary hover:bg-primary/5 transition-all flex items-center gap-3"
          >
            <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Dashboard
          </a>
          <a
            href="{% url 'expense_list' %}"
            class="block px-4 py-3 rounded-xl text-base font-medium text-slate-700 dark:text-slate-300 hover:text-primary dark:hover:text-primary hover:bg-primary/5 transition-all flex items-center gap-3"
          >
            <i data-lucide="history" class="w-5 h-5"></i> History
          </a>
          <a
            href="{% url 'budget_list' %}"
            class="block px-4 py-3 rounded-xl text-base font-medium text-slate-700 dark:text-slate-300 hover:text-primary dark:hover:text-primary hover:bg-primary/5 transition-all flex items-center gap-3"
          >
            <i data-lucide="pie-chart" class="w-5 h-5"></i> Budgets
          </a>
          <div class="border-t border-slate-100 my-2"></div>
          <div
            class="px-4 py-3 flex items-center justify-between bg-slate-50 dark:bg-slate-800/50 rounded-xl"
          >
            <div class="flex items-center gap-3">
              <div
                class="h-8 w-8 rounded-full bg-white dark:bg-slate-800 flex items-center justify-center border border-slate-200 dark:border-slate-700"
              >
                <i
                  data-lucide="user"
                  class="w-4 h-4 text-slate-500 dark:text-slate-400"
                ></i>
              </div>
              <span class="text-sm font-bold text-slate-700 dark:text-slate-200"
                >{{ user.username }}</span
              >
            </div>
            <div class="flex items-center gap-2">
              <a
                href="{% url 'logout' %}"
                class="text-sm text-red-500 hover:text-red-600 font-medium px-3 py-1.5 rounded-lg bg-red-50 dark:bg-red-500/10 hover:bg-red-100 dark:hover:bg-red-500/20 transition-colors"
                >Logout</a
              >
            </div>
          </div>
        </div>
      </div>
    </nav>
    <div class="h-16"></div>
    <!-- Spacer for fixed nav -->
    {% endif %}

    <!-- Main Content -->
    <main
      class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-fade-in"
    >
      <!-- Toast Notifications Container (Corner Positioned) -->
      {% if messages %}
      <div
        class="fixed top-20 right-4 z-[99] flex flex-col gap-3 pointer-events-none sm:top-24 sm:right-6"
      >
        {% for message in messages %}
        <div
          class="toast-item pointer-events-auto flex items-start w-full max-w-sm bg-white rounded-xl shadow-2xl border border-slate-100 overflow-hidden transform animate-slide-in-right ring-1 ring-black/5"
        >
          <!-- Color Strip -->
          <div
            class="flex-shrink-0 flex items-center justify-center w-12 self-stretch bg-gradient-to-b {% if message.tags == 'success' %}from-emerald-400 to-emerald-500{% elif message.tags == 'error' %}from-red-400 to-red-500{% elif message.tags == 'warning' %}from-amber-400 to-amber-500{% else %}from-blue-400 to-blue-500{% endif %}"
          >
            <i
              data-lucide="{% if message.tags == 'success' %}check{% elif message.tags == 'error' %}x{% elif message.tags == 'warning' %}alert-triangle{% else %}info{% endif %}"
              class="w-6 h-6 text-white"
            ></i>
          </div>

          <!-- Content -->
          <div class="px-4 py-3 bg-white/95 backdrop-blur-sm flex-grow min-w-0">
            <h4
              class="text-sm font-bold tracking-wide uppercase {% if message.tags == 'success' %}text-emerald-700{% elif message.tags == 'error' %}text-red-700{% elif message.tags == 'warning' %}text-amber-700{% else %}text-blue-700{% endif %}"
            >
              {{ message.tags|default:"Info" }}
            </h4>
            <p class="text-sm text-slate-600 mt-1 leading-relaxed">
              {{ message }}
            </p>
          </div>

          <!-- Close Button -->
          <button
            onclick="dismissToast(this.parentElement)"
            class="p-2 text-slate-300 hover:text-slate-500 transition-colors self-start mt-1 mr-1"
          >
            <i data-lucide="x" class="w-4 h-4"></i>
          </button>
        </div>
        {% endfor %}
      </div>
      {% endif %} {% block content %} {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="mt-auto py-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div
          class="border-t border-slate-200 pt-8 flex flex-col md:flex-row justify-between items-center gap-4"
        >
          <p class="text-sm text-slate-500">
            &copy; {% now "Y" %} Finance Tracker. All rights reserved.
          </p>
          <div class="flex gap-4">
            <a
              href="#"
              class="text-sm text-slate-400 hover:text-primary transition-colors"
              >Privacy Policy</a
            >
            <a
              href="#"
              class="text-sm text-slate-400 hover:text-primary transition-colors"
              >Terms of Service</a
            >
          </div>
        </div>
      </div>
    </footer>

    <!-- Confirmation Modal -->
    <div
      id="deleteModal"
      class="fixed inset-0 z-[100] hidden"
      aria-labelledby="modal-title"
      role="dialog"
      aria-modal="true"
    >
      <!-- Background backdrop -->
      <div
        class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity backdrop-blur-sm"
        onclick="closeDeleteModal()"
      ></div>

      <div class="fixed inset-0 z-10 overflow-y-auto">
        <div
          class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"
        >
          <div
            class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg border border-gray-100"
          >
            <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
              <div class="sm:flex sm:items-start">
                <div
                  class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
                >
                  <i
                    data-lucide="alert-triangle"
                    class="h-6 w-6 text-red-600"
                  ></i>
                </div>
                <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                  <h3
                    class="text-lg font-semibold leading-6 text-gray-900"
                    id="modal-title"
                  >
                    Delete Expense
                  </h3>
                  <div class="mt-2">
                    <p class="text-sm text-gray-500">
                      Are you sure you want to delete this expense? This action
                      cannot be undone.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6"
            >
              <button
                type="button"
                id="confirmDeleteBtn"
                class="inline-flex w-full justify-center rounded-lg bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto transition-all hover:scale-105"
              >
                Delete
              </button>
              <button
                type="button"
                onclick="closeDeleteModal()"
                class="mt-3 inline-flex w-full justify-center rounded-lg bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto transition-all"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script>
      lucide.createIcons();

      // Modal Logic
      let formToSubmit = null;

      function openDeleteModal(formElement) {
        formToSubmit = formElement;
        const modal = document.getElementById("deleteModal");
        modal.classList.remove("hidden");
        // Animate in
        const content = modal.querySelector(".relative");
        content.classList.add("scale-95", "opacity-0");
        setTimeout(() => {
          content.classList.remove("scale-95", "opacity-0");
          content.classList.add("scale-100", "opacity-100");
        }, 10);
      }

      function closeDeleteModal() {
        const modal = document.getElementById("deleteModal");
        // Animate out
        const content = modal.querySelector(".relative");
        content.classList.remove("scale-100", "opacity-100");
        content.classList.add("scale-95", "opacity-0");

        setTimeout(() => {
          modal.classList.add("hidden");
          formToSubmit = null;
        }, 200);
      }

      document
        .getElementById("confirmDeleteBtn")
        .addEventListener("click", () => {
          if (formToSubmit) {
            formToSubmit.submit();
          }
          closeDeleteModal();
        });

      // Close on escape key
      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closeDeleteModal();
        }
      });

      // Mobile Menu Toggle with Smooth Animation
      const menuBtn = document.getElementById("mobile-menu-btn");
      const mobileMenu = document.getElementById("mobile-menu");

      if (menuBtn && mobileMenu) {
        menuBtn.addEventListener("click", () => {
          // Toggle active classes
          const isOpen = !mobileMenu.classList.contains("-translate-y-[150%]");

          if (isOpen) {
            // Close
            mobileMenu.classList.add(
              "-translate-y-[150%]",
              "opacity-0",
              "-z-10",
              "pointer-events-none",
            );
            mobileMenu.classList.remove("mobile-menu-enter");
          } else {
            // Open
            mobileMenu.classList.remove(
              "-translate-y-[150%]",
              "opacity-0",
              "-z-10",
              "pointer-events-none",
            );
            mobileMenu.classList.add("mobile-menu-enter");
          }
        });
      }

      // Improved Toast Dismissal
      function dismissToast(element) {
        element.style.animation = "none"; // reset
        element.classList.remove("animate-slide-in-right");
        element.classList.add("animate-slide-out-right"); // trigger exit animation
        setTimeout(() => element.remove(), 300); // match animation duration
      }

      // Auto-dismiss toasts
      setTimeout(() => {
        const toasts = document.querySelectorAll(".toast-item");
        toasts.forEach((t) => {
          dismissToast(t);
        });
      }, 5000);
    </script>
  </body>
</html>
